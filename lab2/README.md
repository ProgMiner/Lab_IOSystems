# Лабораторная работа 2

**Название:** "Разработка драйверов блочных устройств"

**Цель работы:** 

получить знания и навыки разработки драйверов блочных устройств для операционной системы Linux. 

## Описание функциональности драйвера

Драйвер создаёт виртуальный жесткий диск в оперативной  памяти с размером 50 Мбайт. 
Созданный диск должен быть разбит на один первичный раздел размером 10Мбайт и один  расширенный раздел, содержащий два логических раздела  размером 20Мбайт каждый.

## Инструкция по сборке
**требуемая версия ядра:** 4.15

Выполнить
```bash
sudo apt install build-essential linux-headers-`uname -r`
make
```

## Инструкция пользователя

для загрузки модуля выпонлить 
```bash
make load
```

для выгрузки модуля 
```bash
make unload
```
проверить, что драйвер загрузился без ошибок командой 
```bash
dmesg
```
## Примеры использования
Выполнить команду `fdisk -l`

Ожидаемый результат
```bash
Device        Boot    Start     End       Sectors   Size    Id    Type
/dev/lab2p1           1         20480     20480     10M     83    Linux
/dev/lab2p2           20481     102402    81922     40M     5     Extended
/dev/lab2p5           20482     61441     40960     20M     0     Empty
/dev/lab2p6           20483     81923     40960     20M     0     Empty
```


## Тестирование драйвера замером времени копирования

```bash
\mkfs.fat 4.1 (2017-01-24)
mkfs.fat 4.1 (2017-01-24)
mkfs.fat 4.1 (2017-01-24)
mount: /mnt/disk1: /dev/lab2p1 already mounted on /mnt/disk1.
5+0 records in
5+0 records out
5242880 bytes (5,2 MB, 5,0 MiB) copied, 0,156763 s, 33,4 MB/s
5+0 records in
5+0 records out
5242880 bytes (5,2 MB, 5,0 MiB) copied, 0,149525 s, 35,1 MB/s
5+0 records in
5+0 records out
5242880 bytes (5,2 MB, 5,0 MiB) copied, 0,151667 s, 34,6 MB/s
Copying files within virtual disk
5,00MiB 0:00:00 [ 923MiB/s] [================================>] 100%            
5,00MiB 0:00:00 [ 807MiB/s] [================================>] 100%            
5,00MiB 0:00:00 [ 716MiB/s] [================================>] 100%            
5+0 records in
5+0 records out
5242880 bytes (5,2 MB, 5,0 MiB) copied, 0,156289 s, 33,5 MB/s
5+0 records in
5+0 records out
5242880 bytes (5,2 MB, 5,0 MiB) copied, 0,149186 s, 35,1 MB/s
5+0 records in
5+0 records out
5242880 bytes (5,2 MB, 5,0 MiB) copied, 0,14798 s, 35,4 MB/s
Copying files from virtual file to real disk
5,00MiB 0:00:00 [1,69GiB/s] [================================>] 100%            
5,00MiB 0:00:00 [1,56GiB/s] [================================>] 100%            
5,00MiB 0:00:00 [1,57GiB/s] [================================>] 100%  
```
